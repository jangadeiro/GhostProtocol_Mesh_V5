version: '3.8'

services:
  ghost-node:
    build: .
    container_name: ghost_mesh_node
    restart: unless-stopped
    # Bluetooth ve UDP Broadcast'in sağlıklı çalışması için
    # Host ağını kullanmak en iyisidir (Linux sunucularda önerilir).
    # Mac/Windows'ta 'network_mode: host' çalışmaz, port mapping kullanılır.
    # network_mode: host 
    ports:
      - "5000:5000"
      - "9999:9999/udp"
    volumes:
      # Verilerin kalıcı olması için
      - ./ghost_v5.db:/app/ghost_v5.db
    privileged: true  # Bluetooth donanımına erişim için gerekebilir
    cap_add:
      - NET_ADMIN     # Ağ keşfi için gerekli yetkiler
    environment:
      - FLASK_ENV=production

  # (Opsiyonel) Gateway Sunucusu
  nginx:
    image: nginx:alpine
    container_name: ghost_gateway
    restart: always
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - ghost-node